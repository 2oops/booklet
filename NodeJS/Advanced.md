# Advanced

1. `NodeJs`是`JS`在服务端的运行环境，构建在`V8`引擎之上，基于事件驱动、非阻塞I/O模型，审核I/O密集型的应用场景。在`Web`服务器方面，`Nginx`也是采用的事件驱动的模式，其采用C语言编写，主要用来做高性能的`Web`服务器，而不适合做业务。

2. 单核CPU系统可采用`单进程 +单线程`，而多核CPU系统上，可使用`多进程+单线程`的模式，开启多进程并不是为了解决高并发，而是为了解决单进程模式下CPU利用率不足的情况，充分利用多核CPU的性能。

3. `NodeJs`虽然是单线程模型，但是基于事件驱动和异步非阻塞模式，它仍适合高并发场景。`JS`是单线程，但作为宿主环境的`NodeJS`并非单线程的。`process` 全局对象，无需`require`。

4. `NodeJs`进程创建

   `NodeJs`提供了`child_process`内置模块，用于创建子进程。

   - `child_process.spawn()`：适用于返回大量数据，例如图像处理，二进制数据处理。
   - `child_process.exec()`：适用于小量数据，maxBuffer 默认值为 200 * 1024 超出这个默认值将会导致程序崩溃，数据量过大可采用 spawn。
   - `child_process.execFile()`：类似 child_process.exec()，区别是不能通过 shell 来执行，不支持像 I/O 重定向和文件查找这样的行为
   - `child_process.fork()`： 衍生新的进程，进程之间是相互独立的，每个进程都有自己的 `V8` 实例、内存，系统资源是有限的，不建议衍生太多的子进程出来，通长根据系统 CPU 核心数设置

5. 守护进程

   守护进程是指运行在后台不受终端的影响

#### I/O(2019-11-03)

1. 阻塞I/O和非阻塞I/O

   非阻塞I/O：这种模式下一个用户进程发起一个 I/O 操作之后，如果数据没有就绪，会立刻返回（标志数据资源不可用），此时 CPU 时间片可以用来做一些其它事情。

2. 同步I/O与异步I/O

3. `OSI`七层模型和网际网协议族图

   ![img](https://www.nodejs.red/nodejs/img/IO_%E7%94%A8%E6%88%B7%E4%B8%8E%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4_OSI.png)

4. 操作系统的I/O模型分为5种：阻塞I/O、非阻塞I/O、I/O复用、信号驱动I/O、异步I/O

5. I/O多路复用：这里的 I/O 通常指网络 I/O，多路指多个 Socket 链接，复用指操作系统进行运算调度的最小单位**线程**。整体意思也就是多个网络 I/O 复用一个或少量的线程来处理 Socket。

   I/O多路复用有多种实现模式：`select poll epoll kqueue`

   `Nginx`即是基于`epoll`来实现的高并发，链接很小的情况下使用`select`可满足，但是大流量、高并发情况下`epoll`还是首选模型。