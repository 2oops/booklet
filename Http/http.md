# Http

#### UDP

1. `UDP`是面向无连接的，即不需要在式传递数据前连接双方，传递的报文不保证有序也不保证不丢失，并且没有控制流量的算法，相对`TCP`来说也更轻便。

2. 不需要和`TCP`一样通过三次握手建立联系，传递报文时也不会对其进行任何拆分和拼接操作。即在发送端，应用层将数据传递给传输层，使用的`UDP`协议只会给数据添加一个`UDP`头部标识，表示是使用的`UDP`协议，就传给网络层了。在接收端，网络层将数据传给传输层，`UDP`只去掉报文头就直接传给应用层，而不会做任何拼接操作。

3. 不可靠性。没有拥塞控制，网络不好可能会丢包，但对于**电话会议**这种使用场景还是有其优势。

4. `UDP`的头部开销小，只有8字节，相比于`TCP`的至少20字节少得多，因此传输是**高效**的。

5. ![img](https://user-gold-cdn.xitu.io/2018/5/1/163195b245ceb89c?imageslim)

   `UDP`头部包含：

   - 前16位包含源端口（可选）和目标端口
   - 整个数据报文的长度
   - 整个数据报文的检验和`IPV4`（可选），用于发现头部信息和数据中的错误

6. `UDP`还支持一对多。适用于**直播，实时性高的游戏（王者荣耀？）**

#### TCP

1. 全双工，建立和断开连接都需要握手，通过各种算法保证了数据的可靠性，相对来说也就没那么高效。

2. ![img](https://user-gold-cdn.xitu.io/2018/5/1/1631be45b084e4bc?imageslim)

   相对来说，`TCP`头部复杂的多：

   - `Sequence number`保证报文有序传输，对端也可以通过序号顺序拼接报文；

   - `Acknowledgment number`表示的是接收端希望接收的下一个字节编号是多少，同时也标示着上一个序号的数据已经收到；

   - `Window Size`表示能接收的字节数据的多少，便于流量控制。

   - 标识符：

     `URG = 1`：紧急信息

     `ACK = 1`：表示确认号字段有效

     `PSH = 1`：表示接收端应立即将该数据push到应用层，而不是等缓冲区满后再提交

     `RST = 1`：表示连接出现问题

     `SYN = 1`：当`SYN = 1， ACK = 0`时，表示当前报文段是连接请求报文，均为1时则是表示同意连接的应答报文

     `FIN = 1`：表示释放连接的请求报文

3. 状态机

   `RTT`：该指标表示发送端发送数据到接收端接收到数据所需的往返时间

4. 为什么 TCP 建立连接需要三次握手，明明两次就可以建立起连接？

   因为这是为了防止出现失效的连接请求报文段被服务端接收的情况，从而产生错误。

5. `ARQ`协议

   即超时重传机制，已保证数据的正确送达。其中又包括`停止等待ARQ`和`连续ARQ`协议两种。

6. 滑动窗口

   发送窗口和接收窗口大小是动态的，发送窗口会随着接收窗口的大小而调整，以达到一个流量控制的目的。发送端口包含已发送但没收到应答的数据和可以发送但还未发送的数据。此外还可能出现`Zero窗口`。

7. 拥塞处理

   拥塞处理和流量控制不同，后者是作用于接收方，保证接收方来得及接收到数据。而前者是作用于网络，防止过多的数据拥塞网络，避免出现网络负载过大的情况。

   拥塞处理包含四个算法：**慢开始、拥塞避免、快速重传、快速恢复**

   **慢开始**即是说一开始不会将带宽拉满，就像下载的时候速度是慢慢升起来的。

   **拥塞避免**每过一个 `RTT` 窗口大小只加一，这样能够避免指数级增长导致网络拥塞，慢慢将大小调整到最佳值

   **快速重传**一般和**快速恢复**一起出现。一旦接收端收到的报文出现失序的情况，接收端只会回复最后一个顺序正确的报文序号。如果发送端收到三个重复的` ACK`，无需等待定时器超时而是直接启动快速重传算法。包括`TCP Taho`和`TCP Reno`

**总结：**

> 建立连接需要三次握手，断开连接需要四次握手
>
> 滑动窗口解决了数据的丢包、顺序不对和流量控制问题
>
> 拥塞窗口实现了对流量的控制，保证在全天候环境下最优的传递数据

​	